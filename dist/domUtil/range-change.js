"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var provide_1 = require("../util/provide");
var nm = provide_1.default('domUtil');
var mouseIn = false;
var mouseDown = false;
var timeout = null;
var dragged = false;
var lastVal;
/**
 * Created by gavorhes on 11/2/2015.
 */
function triggerCallback(callback, evt) {
    "use strict";
    var val = parseFloat(this.value);
    var min = parseFloat(this.min);
    var max = parseFloat(this.max);
    var step = parseFloat(this.step);
    if (max - val < step) {
        val = max;
    }
    var percent = (val - min) / (max - min);
    if (typeof lastVal == 'number' && val == lastVal) {
        return;
    }
    lastVal = val;
    callback(val, percent, evt);
}
/**
 * Add a variety of listeners for range inputs applied to a common callback
 * @param  $slider - jquery reference to the slider
 * @param {rangeChangeCallback} callback - the callback
 * @param {number} [changeTimeout=75] before the callback is called
 * @this {jQuery}
 * @returns {jQuery} the jQuery object
 */
function rangeChange($slider, callback, changeTimeout) {
    changeTimeout = typeof changeTimeout == 'number' ? changeTimeout : 75;
    $slider.mouseenter(function () {
        mouseIn = true;
    });
    $slider.mouseleave(function () {
        mouseIn = false;
        mouseDown = false;
    });
    $slider.mousedown(function () {
        mouseDown = true;
    });
    $slider.mouseup(function () {
        mouseDown = false;
    });
    $slider.mousemove(
    /**
     *
     * @param {object} evt - event properties
     * @this {HTMLElement}
     */
    function (evt) {
        if (!(mouseIn && mouseDown)) {
            return;
        }
        dragged = true;
        if (lastVal == this['value']) {
            return;
        }
        lastVal = this['value'];
        if (timeout != null) {
            clearTimeout(timeout);
        }
        var _this = this;
        timeout = setTimeout(function () {
            triggerCallback.call(_this, callback, evt);
            timeout = null;
        }, changeTimeout);
    });
    $slider.keyup(
    /**
     *
     * @param {object} evt - event properties
     */
    function (evt) {
        if (evt.keyCode == 37 || evt.keyCode == 39) {
            triggerCallback.call(this, callback, evt);
        }
    });
    $slider.change(function (evt) {
        if (dragged) {
            dragged = false;
            return;
        }
        triggerCallback.call(this, callback, evt);
    });
    return this;
}
exports.rangeChange = rangeChange;
nm.rangeChange = rangeChange;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmFuZ2UtY2hhbmdlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2RvbVV0aWwvcmFuZ2UtY2hhbmdlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsMkNBQXNDO0FBR3RDLElBQU0sRUFBRSxHQUFHLGlCQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7QUFFOUIsSUFBSSxPQUFPLEdBQUcsS0FBSyxDQUFDO0FBQ3BCLElBQUksU0FBUyxHQUFHLEtBQUssQ0FBQztBQUN0QixJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUM7QUFDbkIsSUFBSSxPQUFPLEdBQUcsS0FBSyxDQUFDO0FBQ3BCLElBQUksT0FBTyxDQUFDO0FBeUJaOztHQUVHO0FBRUgseUJBQXlCLFFBQThCLEVBQUUsR0FBRztJQUN4RCxZQUFZLENBQUM7SUFFYixJQUFJLEdBQUcsR0FBRyxVQUFVLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ2pDLElBQUksR0FBRyxHQUFHLFVBQVUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDL0IsSUFBSSxHQUFHLEdBQUcsVUFBVSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUMvQixJQUFJLElBQUksR0FBRyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBRWpDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDLENBQUEsQ0FBQztRQUNsQixHQUFHLEdBQUcsR0FBRyxDQUFDO0lBQ2QsQ0FBQztJQUVELElBQUksT0FBTyxHQUFJLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQyxDQUFDO0lBRXpDLEVBQUUsQ0FBQyxDQUFDLE9BQU8sT0FBTyxJQUFJLFFBQVEsSUFBSSxHQUFHLElBQUssT0FBTyxDQUFDLENBQUEsQ0FBQztRQUMvQyxNQUFNLENBQUM7SUFDWCxDQUFDO0lBQ0QsT0FBTyxHQUFHLEdBQUcsQ0FBQztJQUNkLFFBQVEsQ0FBQyxHQUFHLEVBQUUsT0FBTyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0FBQ2hDLENBQUM7QUFJRDs7Ozs7OztHQU9HO0FBQ0gscUJBQTZCLE9BQWUsRUFBRSxRQUE4QixFQUFFLGFBQXFCO0lBRS9GLGFBQWEsR0FBRyxPQUFRLGFBQWEsSUFBSSxRQUFRLEdBQUcsYUFBYSxHQUFHLEVBQUUsQ0FBQztJQUV2RSxPQUFPLENBQUMsVUFBVSxDQUFDO1FBQ2YsT0FBTyxHQUFHLElBQUksQ0FBQztJQUNuQixDQUFDLENBQUMsQ0FBQztJQUVILE9BQU8sQ0FBQyxVQUFVLENBQUM7UUFDZixPQUFPLEdBQUcsS0FBSyxDQUFDO1FBQ2hCLFNBQVMsR0FBRyxLQUFLLENBQUM7SUFDdEIsQ0FBQyxDQUFDLENBQUM7SUFFSCxPQUFPLENBQUMsU0FBUyxDQUFDO1FBQ2QsU0FBUyxHQUFHLElBQUksQ0FBQztJQUNyQixDQUFDLENBQUMsQ0FBQztJQUVILE9BQU8sQ0FBQyxPQUFPLENBQUM7UUFDWixTQUFTLEdBQUcsS0FBSyxDQUFDO0lBQ3RCLENBQUMsQ0FBQyxDQUFDO0lBRUgsT0FBTyxDQUFDLFNBQVM7SUFDYjs7OztPQUlHO0lBQ0gsVUFBVSxHQUFHO1FBQ2IsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sSUFBSSxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDMUIsTUFBTSxDQUFDO1FBQ1gsQ0FBQztRQUVELE9BQU8sR0FBRyxJQUFJLENBQUM7UUFFZixFQUFFLENBQUMsQ0FBQyxPQUFPLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMzQixNQUFNLENBQUM7UUFDWCxDQUFDO1FBQ0QsT0FBTyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUV4QixFQUFFLENBQUMsQ0FBQyxPQUFPLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQztZQUNsQixZQUFZLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDMUIsQ0FBQztRQUVELElBQUksS0FBSyxHQUFHLElBQUksQ0FBQztRQUVqQixPQUFPLEdBQUcsVUFBVSxDQUFDO1lBQ2pCLGVBQWUsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLFFBQVEsRUFBRSxHQUFHLENBQUMsQ0FBQztZQUMzQyxPQUFPLEdBQUcsSUFBSSxDQUFDO1FBRW5CLENBQUMsRUFBRSxhQUFhLENBQUMsQ0FBQztJQUN0QixDQUFDLENBQUMsQ0FBQztJQUVILE9BQU8sQ0FBQyxLQUFLO0lBQ1Q7OztPQUdHO0lBQ0gsVUFBVSxHQUFHO1FBQ2IsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLE9BQU8sSUFBSSxFQUFFLElBQUksR0FBRyxDQUFDLE9BQU8sSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ3pDLGVBQWUsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLFFBQVEsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUM5QyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxPQUFPLENBQUMsTUFBTSxDQUFDLFVBQVUsR0FBRztRQUN4QixFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQ1YsT0FBTyxHQUFHLEtBQUssQ0FBQztZQUVoQixNQUFNLENBQUM7UUFDWCxDQUFDO1FBQ0QsZUFBZSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsUUFBUSxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQzlDLENBQUMsQ0FBQyxDQUFDO0lBRUgsTUFBTSxDQUFDLElBQUksQ0FBQztBQUNoQixDQUFDO0FBekVELGtDQXlFQztBQUVELEVBQUUsQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHByb3ZpZGUgZnJvbSAnLi4vdXRpbC9wcm92aWRlJztcclxuaW1wb3J0ICQgPSByZXF1aXJlKCdqcXVlcnknKTtcclxuXHJcbmNvbnN0IG5tID0gcHJvdmlkZSgnZG9tVXRpbCcpO1xyXG5cclxubGV0IG1vdXNlSW4gPSBmYWxzZTtcclxubGV0IG1vdXNlRG93biA9IGZhbHNlO1xyXG5sZXQgdGltZW91dCA9IG51bGw7XHJcbmxldCBkcmFnZ2VkID0gZmFsc2U7XHJcbmxldCBsYXN0VmFsO1xyXG5cclxuXHJcbi8qKlxyXG4gKiBjYWxsYmFjayBvbiByYW5nZSBjaGFuZ2UgaW50ZXJhY3Rpb24sIGNvbnRleHQgb2YgdGhpcyBpcyB0aGUgZmlyaW5nIGRvbSBlbGVtZW50XHJcbiAqIEBjYWxsYmFjayByYW5nZUNoYW5nZUNhbGxiYWNrXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBuZXdWYWx1ZVxyXG4gKiBAcGFyYW0ge251bWJlcn0gcmF0aW8gdmFsdWUgZnJvbSAwIHRvIDEgcmVsYXRpdmUgb2YgdGhlIHZhbHVlIHRvIHRoZSBtaW4gYW5kIG1heFxyXG4gKiBAcGFyYW0ge29iamVjdH0gZXZ0XHJcbiAqL1xyXG5cclxuLyoqKlxyXG4gKiBjYWxsYmFjayBmdW5jaW9uIGFmdGVyIHRoZSBzbGlkZXIgaGFzIGJlZW4gbW92ZWRcclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgcmFuZ2VDaGFuZ2VkQ2FsbGJhY2t7XHJcbiAgICAvKipcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gbmV3VmFsdWUgbmV3IHZhbHVlIG9mIHRoZSBzbGlkZXJcclxuICAgICAqIEBwYXJhbSByYXRpbyByYXRpbyBmcm9tIGxvdyB0byBoaWdoLCAwIHRvIDFcclxuICAgICAqIEBwYXJhbSBldnQgdGhlIG9yaWdpbmFsIGV2ZW50XHJcbiAgICAgKi9cclxuICAgIChuZXdWYWx1ZTogbnVtYmVyLCByYXRpbzogbnVtYmVyLCBldnQ6IEV2ZW50KTogYW55XHJcbn1cclxuXHJcblxyXG4vKipcclxuICogQ3JlYXRlZCBieSBnYXZvcmhlcyBvbiAxMS8yLzIwMTUuXHJcbiAqL1xyXG5cclxuZnVuY3Rpb24gdHJpZ2dlckNhbGxiYWNrKGNhbGxiYWNrOiByYW5nZUNoYW5nZWRDYWxsYmFjaywgZXZ0KSB7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuXHJcbiAgICBsZXQgdmFsID0gcGFyc2VGbG9hdCh0aGlzLnZhbHVlKTtcclxuICAgIGxldCBtaW4gPSBwYXJzZUZsb2F0KHRoaXMubWluKTtcclxuICAgIGxldCBtYXggPSBwYXJzZUZsb2F0KHRoaXMubWF4KTtcclxuICAgIGxldCBzdGVwID0gcGFyc2VGbG9hdCh0aGlzLnN0ZXApO1xyXG5cclxuICAgIGlmIChtYXggLSB2YWwgPCBzdGVwKXtcclxuICAgICAgICB2YWwgPSBtYXg7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IHBlcmNlbnQgPSAgKHZhbCAtIG1pbikgLyAobWF4IC0gbWluKTtcclxuXHJcbiAgICBpZiAodHlwZW9mIGxhc3RWYWwgPT0gJ251bWJlcicgJiYgdmFsID09ICBsYXN0VmFsKXtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBsYXN0VmFsID0gdmFsO1xyXG4gICAgY2FsbGJhY2sodmFsLCBwZXJjZW50LCBldnQpO1xyXG59XHJcblxyXG5cclxuXHJcbi8qKlxyXG4gKiBBZGQgYSB2YXJpZXR5IG9mIGxpc3RlbmVycyBmb3IgcmFuZ2UgaW5wdXRzIGFwcGxpZWQgdG8gYSBjb21tb24gY2FsbGJhY2tcclxuICogQHBhcmFtICAkc2xpZGVyIC0ganF1ZXJ5IHJlZmVyZW5jZSB0byB0aGUgc2xpZGVyXHJcbiAqIEBwYXJhbSB7cmFuZ2VDaGFuZ2VDYWxsYmFja30gY2FsbGJhY2sgLSB0aGUgY2FsbGJhY2tcclxuICogQHBhcmFtIHtudW1iZXJ9IFtjaGFuZ2VUaW1lb3V0PTc1XSBiZWZvcmUgdGhlIGNhbGxiYWNrIGlzIGNhbGxlZFxyXG4gKiBAdGhpcyB7alF1ZXJ5fVxyXG4gKiBAcmV0dXJucyB7alF1ZXJ5fSB0aGUgalF1ZXJ5IG9iamVjdFxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHJhbmdlQ2hhbmdlICgkc2xpZGVyOiBKUXVlcnksIGNhbGxiYWNrOiByYW5nZUNoYW5nZWRDYWxsYmFjaywgY2hhbmdlVGltZW91dDogbnVtYmVyKSB7XHJcblxyXG4gICAgY2hhbmdlVGltZW91dCA9IHR5cGVvZiAgY2hhbmdlVGltZW91dCA9PSAnbnVtYmVyJyA/IGNoYW5nZVRpbWVvdXQgOiA3NTtcclxuXHJcbiAgICAkc2xpZGVyLm1vdXNlZW50ZXIoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIG1vdXNlSW4gPSB0cnVlO1xyXG4gICAgfSk7XHJcblxyXG4gICAgJHNsaWRlci5tb3VzZWxlYXZlKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBtb3VzZUluID0gZmFsc2U7XHJcbiAgICAgICAgbW91c2VEb3duID0gZmFsc2U7XHJcbiAgICB9KTtcclxuXHJcbiAgICAkc2xpZGVyLm1vdXNlZG93bihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgbW91c2VEb3duID0gdHJ1ZTtcclxuICAgIH0pO1xyXG5cclxuICAgICRzbGlkZXIubW91c2V1cChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgbW91c2VEb3duID0gZmFsc2U7XHJcbiAgICB9KTtcclxuXHJcbiAgICAkc2xpZGVyLm1vdXNlbW92ZShcclxuICAgICAgICAvKipcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSBldnQgLSBldmVudCBwcm9wZXJ0aWVzXHJcbiAgICAgICAgICogQHRoaXMge0hUTUxFbGVtZW50fVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGZ1bmN0aW9uIChldnQpIHtcclxuICAgICAgICBpZiAoIShtb3VzZUluICYmIG1vdXNlRG93bikpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZHJhZ2dlZCA9IHRydWU7XHJcblxyXG4gICAgICAgIGlmIChsYXN0VmFsID09IHRoaXNbJ3ZhbHVlJ10pIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsYXN0VmFsID0gdGhpc1sndmFsdWUnXTtcclxuXHJcbiAgICAgICAgaWYgKHRpbWVvdXQgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHRyaWdnZXJDYWxsYmFjay5jYWxsKF90aGlzLCBjYWxsYmFjaywgZXZ0KTtcclxuICAgICAgICAgICAgdGltZW91dCA9IG51bGw7XHJcblxyXG4gICAgICAgIH0sIGNoYW5nZVRpbWVvdXQpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgJHNsaWRlci5rZXl1cChcclxuICAgICAgICAvKipcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSBldnQgLSBldmVudCBwcm9wZXJ0aWVzXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZnVuY3Rpb24gKGV2dCkge1xyXG4gICAgICAgIGlmIChldnQua2V5Q29kZSA9PSAzNyB8fCBldnQua2V5Q29kZSA9PSAzOSkge1xyXG4gICAgICAgICAgICB0cmlnZ2VyQ2FsbGJhY2suY2FsbCh0aGlzLCBjYWxsYmFjaywgZXZ0KTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICAkc2xpZGVyLmNoYW5nZShmdW5jdGlvbiAoZXZ0KSB7XHJcbiAgICAgICAgaWYgKGRyYWdnZWQpIHtcclxuICAgICAgICAgICAgZHJhZ2dlZCA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0cmlnZ2VyQ2FsbGJhY2suY2FsbCh0aGlzLCBjYWxsYmFjaywgZXZ0KTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiB0aGlzO1xyXG59XHJcblxyXG5ubS5yYW5nZUNoYW5nZSA9IHJhbmdlQ2hhbmdlO1xyXG5cclxuIl19
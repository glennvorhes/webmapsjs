"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/**
 * Created by gavorhes on 12/23/2015.
 */
var provide_1 = require("../util/provide");
var nm = provide_1.default('olHelpers');
/**
 * take an array of features and sort by a given property name
 */
var SortedFeatures = (function () {
    /**
     *
     * @param {Array<ol.Feature>} features array of ol features
     * @param {string} propertyName - the property name to use for lookup
     */
    function SortedFeatures(features, propertyName) {
        this.sortedFeatures = features;
        this.propertyName = propertyName;
        if (this.sortedFeatures.length > 0) {
            this._propertyType = typeof this.sortedFeatures[0].getProperties()[this.propertyName];
            var __this_1 = this;
            this.sortedFeatures.sort(function (a, b) {
                if (__this_1._propertyType == 'number') {
                    var aMinusB = a['getProperties']()[__this_1.propertyName] - b['getProperties']()[__this_1.propertyName];
                    if (aMinusB == 0) {
                        return 0;
                    }
                    else {
                        return aMinusB > 0 ? 1 : -1;
                    }
                }
                else if (__this_1._propertyType == 'string') {
                    var propA = a['getProperties']()[__this_1.propertyName] || '';
                    var propB = b['getProperties']()[__this_1.propertyName] || '';
                    propA = propA.toString().trim();
                    propB = propB.toString().trim();
                    if (propA == propB) {
                        return 0;
                    }
                    else {
                        return propA > propB ? 1 : 0;
                    }
                }
            });
        }
    }
    /**
     * recursive search to find the value
     * @param {number|string} propertyValue - the property value to search for
     * @param {boolean} [exactMatch=false] if only an exact match should be returned
     * @param {Array} [sortedFeatures=this.sortedFeatures] - the candidate features
     * @returns {ol.Feature|undefined} the feature matching the lookup
     */
    SortedFeatures.prototype.getFeature = function (propertyValue, exactMatch, sortedFeatures) {
        if (exactMatch === void 0) { exactMatch = false; }
        if (typeof sortedFeatures == 'undefined') {
            sortedFeatures = this.sortedFeatures;
        }
        if (sortedFeatures.length == 0) {
            return undefined;
        }
        if (sortedFeatures.length == 1) {
            if (exactMatch) {
                if (sortedFeatures[0].getProperties()[this.propertyName] == propertyValue) {
                    return sortedFeatures[0];
                }
                else {
                    return undefined;
                }
            }
            else {
                return sortedFeatures[0];
            }
        }
        var lowProp = sortedFeatures[0].getProperties()[this.propertyName];
        var highProp = sortedFeatures[sortedFeatures.length - 1].getProperties()[this.propertyName];
        if (exactMatch) {
            if (lowProp == propertyValue) {
                return sortedFeatures[0];
            }
            else if (propertyValue < lowProp) {
                return undefined;
            }
            else if (highProp == propertyValue) {
                return sortedFeatures[sortedFeatures.length - 1];
            }
            else if (propertyValue > highProp) {
                return undefined;
            }
        }
        else {
            if (propertyValue <= lowProp) {
                return sortedFeatures[0];
            }
            else if (propertyValue >= highProp) {
                return sortedFeatures[sortedFeatures.length - 1];
            }
        }
        var midIndex = Math.floor(sortedFeatures.length / 2);
        var midFeature = sortedFeatures[midIndex];
        var midProperty = midFeature.getProperties()[this.propertyName];
        if (midProperty === propertyValue) {
            return midFeature;
        }
        if (propertyValue < midProperty) {
            return this.getFeature(propertyValue, exactMatch, sortedFeatures.slice(0, midIndex));
        }
        else {
            return this.getFeature(propertyValue, exactMatch, sortedFeatures.slice(midIndex));
        }
    };
    return SortedFeatures;
}());
nm.SortedFeatures = SortedFeatures;
exports.default = SortedFeatures;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU29ydGVkRmVhdHVyZXMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvb2xIZWxwZXJzL1NvcnRlZEZlYXR1cmVzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUE7O0dBRUc7QUFDSCwyQ0FBc0M7QUFFdEMsSUFBSSxFQUFFLEdBQUcsaUJBQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQztBQUU5Qjs7R0FFRztBQUNIO0lBS0k7Ozs7T0FJRztJQUNILHdCQUFZLFFBQVEsRUFBRSxZQUFZO1FBQzlCLElBQUksQ0FBQyxjQUFjLEdBQUcsUUFBUSxDQUFDO1FBQy9CLElBQUksQ0FBQyxZQUFZLEdBQUcsWUFBWSxDQUFDO1FBRWpDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDakMsSUFBSSxDQUFDLGFBQWEsR0FBRyxPQUFPLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLENBQUMsYUFBYSxFQUFFLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBRXRGLElBQUksUUFBTSxHQUFHLElBQUksQ0FBQztZQUNsQixJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDO2dCQUNuQyxFQUFFLENBQUMsQ0FBQyxRQUFNLENBQUMsYUFBYSxJQUFJLFFBQVEsQ0FBQyxDQUFBLENBQUM7b0JBQ2xDLElBQUksT0FBTyxHQUFHLENBQUMsQ0FBQyxlQUFlLENBQUMsRUFBRSxDQUFDLFFBQU0sQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLENBQUMsZUFBZSxDQUFDLEVBQUUsQ0FBQyxRQUFNLENBQUMsWUFBWSxDQUFDLENBQUM7b0JBQ3BHLEVBQUUsQ0FBQyxDQUFDLE9BQU8sSUFBSSxDQUFDLENBQUMsQ0FBQSxDQUFDO3dCQUNkLE1BQU0sQ0FBQyxDQUFDLENBQUM7b0JBQ2IsQ0FBQztvQkFBQyxJQUFJLENBQUMsQ0FBQzt3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YyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQztRQUN6RixDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDSixNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLEVBQUUsVUFBVSxFQUFFLGNBQWMsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztRQUN0RixDQUFDO0lBQ0wsQ0FBQztJQUNMLHFCQUFDO0FBQUQsQ0FBQyxBQTFHRCxJQTBHQztBQUVELEVBQUUsQ0FBQyxjQUFjLEdBQUcsY0FBYyxDQUFDO0FBQ25DLGtCQUFlLGNBQWMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGdhdm9yaGVzIG9uIDEyLzIzLzIwMTUuXHJcbiAqL1xyXG5pbXBvcnQgcHJvdmlkZSBmcm9tICcuLi91dGlsL3Byb3ZpZGUnO1xyXG5pbXBvcnQgb2wgPSByZXF1aXJlKCdjdXN0b20tb2wnKTtcclxubGV0IG5tID0gcHJvdmlkZSgnb2xIZWxwZXJzJyk7XHJcblxyXG4vKipcclxuICogdGFrZSBhbiBhcnJheSBvZiBmZWF0dXJlcyBhbmQgc29ydCBieSBhIGdpdmVuIHByb3BlcnR5IG5hbWVcclxuICovXHJcbmNsYXNzIFNvcnRlZEZlYXR1cmVzIHtcclxuICAgIHNvcnRlZEZlYXR1cmVzOiBBcnJheTxvbC5GZWF0dXJlPjtcclxuICAgIHByb3BlcnR5TmFtZTogc3RyaW5nO1xyXG4gICAgX3Byb3BlcnR5VHlwZTogc3RyaW5nO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB7QXJyYXk8b2wuRmVhdHVyZT59IGZlYXR1cmVzIGFycmF5IG9mIG9sIGZlYXR1cmVzXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gcHJvcGVydHlOYW1lIC0gdGhlIHByb3BlcnR5IG5hbWUgdG8gdXNlIGZvciBsb29rdXBcclxuICAgICAqL1xyXG4gICAgY29uc3RydWN0b3IoZmVhdHVyZXMsIHByb3BlcnR5TmFtZSkge1xyXG4gICAgICAgIHRoaXMuc29ydGVkRmVhdHVyZXMgPSBmZWF0dXJlcztcclxuICAgICAgICB0aGlzLnByb3BlcnR5TmFtZSA9IHByb3BlcnR5TmFtZTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuc29ydGVkRmVhdHVyZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICB0aGlzLl9wcm9wZXJ0eVR5cGUgPSB0eXBlb2YgdGhpcy5zb3J0ZWRGZWF0dXJlc1swXS5nZXRQcm9wZXJ0aWVzKClbdGhpcy5wcm9wZXJ0eU5hbWVdO1xyXG5cclxuICAgICAgICAgICAgbGV0IF9fdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgICAgIHRoaXMuc29ydGVkRmVhdHVyZXMuc29ydChmdW5jdGlvbiAoYSwgYikgOiBudW1iZXIge1xyXG4gICAgICAgICAgICAgICAgaWYgKF9fdGhpcy5fcHJvcGVydHlUeXBlID09ICdudW1iZXInKXtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgYU1pbnVzQiA9IGFbJ2dldFByb3BlcnRpZXMnXSgpW19fdGhpcy5wcm9wZXJ0eU5hbWVdIC0gYlsnZ2V0UHJvcGVydGllcyddKClbX190aGlzLnByb3BlcnR5TmFtZV07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFNaW51c0IgPT0gMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhTWludXNCID4gMCA/IDEgOiAtMTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKF9fdGhpcy5fcHJvcGVydHlUeXBlID09ICdzdHJpbmcnKXtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgcHJvcEEgPSBhWydnZXRQcm9wZXJ0aWVzJ10oKVtfX3RoaXMucHJvcGVydHlOYW1lXSB8fCAnJztcclxuICAgICAgICAgICAgICAgICAgICBsZXQgcHJvcEIgPSBiWydnZXRQcm9wZXJ0aWVzJ10oKVtfX3RoaXMucHJvcGVydHlOYW1lXSB8fCAnJztcclxuICAgICAgICAgICAgICAgICAgICBwcm9wQSA9IHByb3BBLnRvU3RyaW5nKCkudHJpbSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHByb3BCID0gcHJvcEIudG9TdHJpbmcoKS50cmltKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwcm9wQSA9PSBwcm9wQil7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwcm9wQSA+IHByb3BCID8gMSA6IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiByZWN1cnNpdmUgc2VhcmNoIHRvIGZpbmQgdGhlIHZhbHVlXHJcbiAgICAgKiBAcGFyYW0ge251bWJlcnxzdHJpbmd9IHByb3BlcnR5VmFsdWUgLSB0aGUgcHJvcGVydHkgdmFsdWUgdG8gc2VhcmNoIGZvclxyXG4gICAgICogQHBhcmFtIHtib29sZWFufSBbZXhhY3RNYXRjaD1mYWxzZV0gaWYgb25seSBhbiBleGFjdCBtYXRjaCBzaG91bGQgYmUgcmV0dXJuZWRcclxuICAgICAqIEBwYXJhbSB7QXJyYXl9IFtzb3J0ZWRGZWF0dXJlcz10aGlzLnNvcnRlZEZlYXR1cmVzXSAtIHRoZSBjYW5kaWRhdGUgZmVhdHVyZXNcclxuICAgICAqIEByZXR1cm5zIHtvbC5GZWF0dXJlfHVuZGVmaW5lZH0gdGhlIGZlYXR1cmUgbWF0Y2hpbmcgdGhlIGxvb2t1cFxyXG4gICAgICovXHJcbiAgICBnZXRGZWF0dXJlKHByb3BlcnR5VmFsdWUsIGV4YWN0TWF0Y2g6IGJvb2xlYW4gPSBmYWxzZSwgc29ydGVkRmVhdHVyZXM/IDpBcnJheTxvbC5GZWF0dXJlPikge1xyXG4gICAgICAgIGlmICh0eXBlb2Ygc29ydGVkRmVhdHVyZXMgPT0gJ3VuZGVmaW5lZCcpe1xyXG4gICAgICAgICAgICBzb3J0ZWRGZWF0dXJlcyA9IHRoaXMuc29ydGVkRmVhdHVyZXM7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgaWYgKHNvcnRlZEZlYXR1cmVzLmxlbmd0aCA9PSAwKXtcclxuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChzb3J0ZWRGZWF0dXJlcy5sZW5ndGggPT0gMSl7XHJcbiAgICAgICAgICAgIGlmIChleGFjdE1hdGNoKXtcclxuICAgICAgICAgICAgICAgIGlmIChzb3J0ZWRGZWF0dXJlc1swXS5nZXRQcm9wZXJ0aWVzKClbdGhpcy5wcm9wZXJ0eU5hbWVdID09IHByb3BlcnR5VmFsdWUpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzb3J0ZWRGZWF0dXJlc1swXTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBzb3J0ZWRGZWF0dXJlc1swXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IGxvd1Byb3AgPSBzb3J0ZWRGZWF0dXJlc1swXS5nZXRQcm9wZXJ0aWVzKClbdGhpcy5wcm9wZXJ0eU5hbWVdO1xyXG4gICAgICAgIGxldCBoaWdoUHJvcCA9IHNvcnRlZEZlYXR1cmVzW3NvcnRlZEZlYXR1cmVzLmxlbmd0aCAtIDFdLmdldFByb3BlcnRpZXMoKVt0aGlzLnByb3BlcnR5TmFtZV07XHJcblxyXG4gICAgICAgIGlmIChleGFjdE1hdGNoKXtcclxuICAgICAgICAgICAgaWYgKGxvd1Byb3AgPT0gcHJvcGVydHlWYWx1ZSl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc29ydGVkRmVhdHVyZXNbMF07XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocHJvcGVydHlWYWx1ZSA8IGxvd1Byb3Ape1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChoaWdoUHJvcCA9PSBwcm9wZXJ0eVZhbHVlKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiBzb3J0ZWRGZWF0dXJlc1tzb3J0ZWRGZWF0dXJlcy5sZW5ndGggLSAxXTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChwcm9wZXJ0eVZhbHVlID4gIGhpZ2hQcm9wKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAocHJvcGVydHlWYWx1ZSA8PSBsb3dQcm9wKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiBzb3J0ZWRGZWF0dXJlc1swXTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChwcm9wZXJ0eVZhbHVlID49IGhpZ2hQcm9wKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiBzb3J0ZWRGZWF0dXJlc1tzb3J0ZWRGZWF0dXJlcy5sZW5ndGggLSAxXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IG1pZEluZGV4ID0gTWF0aC5mbG9vcihzb3J0ZWRGZWF0dXJlcy5sZW5ndGggLyAyKTtcclxuICAgICAgICBsZXQgbWlkRmVhdHVyZSA9IHNvcnRlZEZlYXR1cmVzW21pZEluZGV4XTtcclxuICAgICAgICBsZXQgbWlkUHJvcGVydHkgPSBtaWRGZWF0dXJlLmdldFByb3BlcnRpZXMoKVt0aGlzLnByb3BlcnR5TmFtZV07XHJcblxyXG4gICAgICAgIGlmIChtaWRQcm9wZXJ0eSA9PT0gIHByb3BlcnR5VmFsdWUpe1xyXG4gICAgICAgICAgICByZXR1cm4gbWlkRmVhdHVyZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChwcm9wZXJ0eVZhbHVlIDwgbWlkUHJvcGVydHkpe1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRGZWF0dXJlKHByb3BlcnR5VmFsdWUsIGV4YWN0TWF0Y2gsIHNvcnRlZEZlYXR1cmVzLnNsaWNlKDAsIG1pZEluZGV4KSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RmVhdHVyZShwcm9wZXJ0eVZhbHVlLCBleGFjdE1hdGNoLCBzb3J0ZWRGZWF0dXJlcy5zbGljZShtaWRJbmRleCkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxubm0uU29ydGVkRmVhdHVyZXMgPSBTb3J0ZWRGZWF0dXJlcztcclxuZXhwb3J0IGRlZmF1bHQgU29ydGVkRmVhdHVyZXM7XHJcblxyXG4iXX0=
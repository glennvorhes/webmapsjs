"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/**
 * Created by gavorhes on 11/3/2015.
 */
var provide_1 = require("./provide");
var chk = require("./checkDefined");
var nm = provide_1.default('util.colors');
/**
 * helper function to convert to hex
 * @param {number|string} x - the number to convert to hex
 * @returns {string} number as hex
 * @private
 */
function _hex(x) {
    var hexDigits = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "a", "b", "c", "d", "e", "f"];
    return isNaN(x) ? "00" : hexDigits[(x - x % 16) / 16] + hexDigits[x % 16];
}
/**
 * converts an RGB string to hex
 * @param {string} rgb - rgb color
 * @returns {string} rbg as hex
 */
function rgb2hex(rgb) {
    var rgb1 = rgb.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);
    return ("#" + _hex(rgb1[1]) + _hex(rgb1[2]) + _hex(rgb1[3])).toUpperCase();
}
exports.rgb2hex = rgb2hex;
nm.rgb2hex = rgb2hex;
/**
 * Convert hex string to RGB or RGBA string
 * @param {string} hexString - hex color string
 * @param {number} [alphaVal=undefined] Alpha value
 * @returns {string} - rgb or rgba color
 */
function hexAlphaToRgbOrRgba(hexString, alphaVal) {
    hexString = ((hexString.charAt(0) == "#") ? hexString.substring(1, 7) : hexString);
    var r = parseInt(hexString.substring(0, 2), 16).toString() || '0';
    var g = parseInt(hexString.substring(2, 4), 16).toString() || '0';
    var b = parseInt(hexString.substring(4, 6), 16).toString() || '0';
    if (alphaVal) {
        return "rgba(" + r + "," + g + "," + b + "," + alphaVal + ")";
    }
    else {
        return "rgba(" + r + "," + g + "," + b + ")";
    }
}
exports.hexAlphaToRgbOrRgba = hexAlphaToRgbOrRgba;
nm.hexAlphaToRgbOrRgba = hexAlphaToRgbOrRgba;
/**
 * adds alpha value to rgb string 'rgb(r, b, g)', returns 'rgba(r, g, b, a)'
 * @param {string} rgb - rgb color
 * @param {number} alpha - alpha value 0 to 1
 * @returns {string} rgba color
 */
function rgbToRgba(rgb, alpha) {
    var pieces = rgb.split(',');
    pieces[0] = pieces[0].replace('rgb', 'rgba');
    pieces[2] = pieces[2].replace(')', '');
    pieces.push(' ' + alpha.toFixed(1) + ')');
    return pieces.join(',');
}
exports.rgbToRgba = rgbToRgba;
nm.rgbToRgba = rgbToRgba;
/**
 * @typedef {function} colorLookupByNumber
 * @param {number} num - the number to use to retrieve the color
 * @returns {string} rgb color
 */
/**
 * Make a blue green red gradient
 * @param {number} minVal - minimum value
 * @param {number} maxVal - maximum value
 * @param {boolean} flipColors - if the colors should be flipped
 * @returns {colorLookupByNumber} color lookup function
 */
function makeBlueGreenRedGradient(minVal, maxVal, flipColors) {
    if (typeof flipColors != "boolean") {
        flipColors = false;
    }
    return function (theVal) {
        var r, g, b;
        var ratio;
        if (chk.undefinedOrNull(theVal)) {
            return 'rgb(100,100,100)';
        }
        var percent = (theVal - minVal) / (maxVal - minVal);
        if (flipColors == true) {
            percent = 1 - percent;
        }
        if (percent >= 1) {
            r = 255;
            g = 0;
            b = 0;
        }
        else if (percent <= 0) {
            r = 0;
            g = 0;
            b = 255;
        }
        else if (percent < .25) {
            // green up, blue constant
            r = 0;
            g = Math.floor(255 * percent / 0.25);
            b = 255;
        }
        else if (percent < 0.50) {
            //blue down, green constant
            ratio = (percent - 0.25) / 0.25;
            r = 0;
            g = 255;
            b = 255 - Math.floor(255 * ratio);
        }
        else if (percent < 0.75) {
            // red up, green constant
            ratio = (percent - 0.5) / 0.25;
            r = Math.floor(255 * ratio);
            g = 255;
            b = 0;
        }
        else {
            // green down, red constant
            ratio = (percent - 0.75) / 0.25;
            r = 255;
            g = 255 - Math.floor(255 * ratio);
            b = 0;
        }
        r = r.toFixed();
        g = g.toFixed();
        b = b.toFixed();
        return 'rgb(' + r + ',' + g + ',' + b + ')';
    };
}
exports.makeBlueGreenRedGradient = makeBlueGreenRedGradient;
nm.makeBlueGreenRedGradient = makeBlueGreenRedGradient;
/**
 * Create a function that will return colors based on a gradient
 * @param {number} median - median value
 * @param {number} stdDev - standard deviation
 * @param {boolean} flipColors - if the colors should be flipped
 * @returns {colorLookupByNumber} color lookup function
 */
function makeBlueGreenRedGradientZScore(median, stdDev, flipColors) {
    var grd = makeBlueGreenRedGradient(-2.5, 2.5, flipColors);
    return function (theVal) {
        var zScore;
        if (theVal == null) {
            zScore = null;
        }
        else {
            zScore = (theVal - median) / stdDev;
        }
        return grd(zScore);
    };
}
exports.makeBlueGreenRedGradientZScore = makeBlueGreenRedGradientZScore;
nm.makeBlueGreenRedGradientZScore = makeBlueGreenRedGradientZScore;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sb3JzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3V0aWwvY29sb3JzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUE7O0dBRUc7QUFDSCxxQ0FBZ0M7QUFDaEMsb0NBQXNDO0FBQ3RDLElBQUksRUFBRSxHQUFHLGlCQUFPLENBQUMsYUFBYSxDQUFDLENBQUM7QUFHaEM7Ozs7O0dBS0c7QUFDSCxjQUFjLENBQUM7SUFDWCxJQUFJLFNBQVMsR0FBRyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBRWpHLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxHQUFHLFNBQVMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDLEdBQUcsU0FBUyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztBQUM5RSxDQUFDO0FBRUQ7Ozs7R0FJRztBQUNILGlCQUF3QixHQUFHO0lBQ3ZCLElBQUksSUFBSSxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsa0NBQWtDLENBQUMsQ0FBQztJQUV6RCxNQUFNLENBQUMsQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztBQUMvRSxDQUFDO0FBSkQsMEJBSUM7QUFFRCxFQUFFLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztBQUdyQjs7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TSxDQUFDLEdBQUcsTUFBTSxDQUFDO1FBQ3hDLENBQUM7UUFFRCxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3ZCLENBQUMsQ0FBQztBQUNOLENBQUM7QUFmRCx3RUFlQztBQUVELEVBQUUsQ0FBQyw4QkFBOEIsR0FBRyw4QkFBOEIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGdhdm9yaGVzIG9uIDExLzMvMjAxNS5cclxuICovXHJcbmltcG9ydCBwcm92aWRlIGZyb20gJy4vcHJvdmlkZSc7XHJcbmltcG9ydCAqIGFzIGNoayBmcm9tICcuL2NoZWNrRGVmaW5lZCc7XHJcbmxldCBubSA9IHByb3ZpZGUoJ3V0aWwuY29sb3JzJyk7XHJcblxyXG5cclxuLyoqXHJcbiAqIGhlbHBlciBmdW5jdGlvbiB0byBjb252ZXJ0IHRvIGhleFxyXG4gKiBAcGFyYW0ge251bWJlcnxzdHJpbmd9IHggLSB0aGUgbnVtYmVyIHRvIGNvbnZlcnQgdG8gaGV4XHJcbiAqIEByZXR1cm5zIHtzdHJpbmd9IG51bWJlciBhcyBoZXhcclxuICogQHByaXZhdGVcclxuICovXHJcbmZ1bmN0aW9uIF9oZXgoeCkge1xyXG4gICAgbGV0IGhleERpZ2l0cyA9IFtcIjBcIiwgXCIxXCIsIFwiMlwiLCBcIjNcIiwgXCI0XCIsIFwiNVwiLCBcIjZcIiwgXCI3XCIsIFwiOFwiLCBcIjlcIiwgXCJhXCIsIFwiYlwiLCBcImNcIiwgXCJkXCIsIFwiZVwiLCBcImZcIl07XHJcblxyXG4gICAgcmV0dXJuIGlzTmFOKHgpID8gXCIwMFwiIDogaGV4RGlnaXRzWyh4IC0geCAlIDE2KSAvIDE2XSArIGhleERpZ2l0c1t4ICUgMTZdO1xyXG59XHJcblxyXG4vKipcclxuICogY29udmVydHMgYW4gUkdCIHN0cmluZyB0byBoZXhcclxuICogQHBhcmFtIHtzdHJpbmd9IHJnYiAtIHJnYiBjb2xvclxyXG4gKiBAcmV0dXJucyB7c3RyaW5nfSByYmcgYXMgaGV4XHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gcmdiMmhleChyZ2IpIHtcclxuICAgIGxldCByZ2IxID0gcmdiLm1hdGNoKC9ecmdiXFwoKFxcZCspLFxccyooXFxkKyksXFxzKihcXGQrKVxcKSQvKTtcclxuXHJcbiAgICByZXR1cm4gKFwiI1wiICsgX2hleChyZ2IxWzFdKSArIF9oZXgocmdiMVsyXSkgKyBfaGV4KHJnYjFbM10pKS50b1VwcGVyQ2FzZSgpO1xyXG59XHJcblxyXG5ubS5yZ2IyaGV4ID0gcmdiMmhleDtcclxuXHJcblxyXG4vKipcclxuICogQ29udmVydCBoZXggc3RyaW5nIHRvIFJHQiBvciBSR0JBIHN0cmluZ1xyXG4gKiBAcGFyYW0ge3N0cmluZ30gaGV4U3RyaW5nIC0gaGV4IGNvbG9yIHN0cmluZ1xyXG4gKiBAcGFyYW0ge251bWJlcn0gW2FscGhhVmFsPXVuZGVmaW5lZF0gQWxwaGEgdmFsdWVcclxuICogQHJldHVybnMge3N0cmluZ30gLSByZ2Igb3IgcmdiYSBjb2xvclxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGhleEFscGhhVG9SZ2JPclJnYmEoaGV4U3RyaW5nLCBhbHBoYVZhbCkge1xyXG4gICAgaGV4U3RyaW5nID0gKChoZXhTdHJpbmcuY2hhckF0KDApID09IFwiI1wiKSA/IGhleFN0cmluZy5zdWJzdHJpbmcoMSwgNykgOiBoZXhTdHJpbmcpO1xyXG4gICAgbGV0IHIgPSBwYXJzZUludChoZXhTdHJpbmcuc3Vic3RyaW5nKDAsIDIpLCAxNikudG9TdHJpbmcoKSB8fCAnMCc7XHJcbiAgICBsZXQgZyA9IHBhcnNlSW50KGhleFN0cmluZy5zdWJzdHJpbmcoMiwgNCksIDE2KS50b1N0cmluZygpIHx8ICcwJztcclxuICAgIGxldCBiID0gcGFyc2VJbnQoaGV4U3RyaW5nLnN1YnN0cmluZyg0LCA2KSwgMTYpLnRvU3RyaW5nKCkgfHwgJzAnO1xyXG4gICAgaWYgKGFscGhhVmFsKSB7XHJcbiAgICAgICAgcmV0dXJuIGByZ2JhKCR7cn0sJHtnfSwke2J9LCR7YWxwaGFWYWx9KWA7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiBgcmdiYSgke3J9LCR7Z30sJHtifSlgO1xyXG4gICAgfVxyXG59XHJcblxyXG5ubS5oZXhBbHBoYVRvUmdiT3JSZ2JhID0gaGV4QWxwaGFUb1JnYk9yUmdiYTtcclxuXHJcblxyXG4vKipcclxuICogYWRkcyBhbHBoYSB2YWx1ZSB0byByZ2Igc3RyaW5nICdyZ2IociwgYiwgZyknLCByZXR1cm5zICdyZ2JhKHIsIGcsIGIsIGEpJ1xyXG4gKiBAcGFyYW0ge3N0cmluZ30gcmdiIC0gcmdiIGNvbG9yXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBhbHBoYSAtIGFscGhhIHZhbHVlIDAgdG8gMVxyXG4gKiBAcmV0dXJucyB7c3RyaW5nfSByZ2JhIGNvbG9yXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gcmdiVG9SZ2JhKHJnYiwgYWxwaGEpIHtcclxuICAgIGxldCBwaWVjZXMgPSByZ2Iuc3BsaXQoJywnKTtcclxuICAgIHBpZWNlc1swXSA9IHBpZWNlc1swXS5yZXBsYWNlKCdyZ2InLCAncmdiYScpO1xyXG4gICAgcGllY2VzWzJdID0gcGllY2VzWzJdLnJlcGxhY2UoJyknLCAnJyk7XHJcbiAgICBwaWVjZXMucHVzaCgnICcgKyBhbHBoYS50b0ZpeGVkKDEpICsgJyknKTtcclxuXHJcbiAgICByZXR1cm4gcGllY2VzLmpvaW4oJywnKTtcclxufVxyXG5cclxubm0ucmdiVG9SZ2JhID0gcmdiVG9SZ2JhO1xyXG5cclxuXHJcbi8qKlxyXG4gKiBAdHlwZWRlZiB7ZnVuY3Rpb259IGNvbG9yTG9va3VwQnlOdW1iZXJcclxuICogQHBhcmFtIHtudW1iZXJ9IG51bSAtIHRoZSBudW1iZXIgdG8gdXNlIHRvIHJldHJpZXZlIHRoZSBjb2xvclxyXG4gKiBAcmV0dXJucyB7c3RyaW5nfSByZ2IgY29sb3JcclxuICovXHJcblxyXG5cclxuLyoqXHJcbiAqIE1ha2UgYSBibHVlIGdyZWVuIHJlZCBncmFkaWVudFxyXG4gKiBAcGFyYW0ge251bWJlcn0gbWluVmFsIC0gbWluaW11bSB2YWx1ZVxyXG4gKiBAcGFyYW0ge251bWJlcn0gbWF4VmFsIC0gbWF4aW11bSB2YWx1ZVxyXG4gKiBAcGFyYW0ge2Jvb2xlYW59IGZsaXBDb2xvcnMgLSBpZiB0aGUgY29sb3JzIHNob3VsZCBiZSBmbGlwcGVkXHJcbiAqIEByZXR1cm5zIHtjb2xvckxvb2t1cEJ5TnVtYmVyfSBjb2xvciBsb29rdXAgZnVuY3Rpb25cclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBtYWtlQmx1ZUdyZWVuUmVkR3JhZGllbnQobWluVmFsLCBtYXhWYWwsIGZsaXBDb2xvcnMpIHtcclxuXHJcbiAgICBpZiAodHlwZW9mIGZsaXBDb2xvcnMgIT0gXCJib29sZWFuXCIpIHtcclxuICAgICAgICBmbGlwQ29sb3JzID0gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGZ1bmN0aW9uICh0aGVWYWwpIHtcclxuICAgICAgICBsZXQgciwgZywgYjtcclxuICAgICAgICBsZXQgcmF0aW87XHJcblxyXG4gICAgICAgIGlmIChjaGsudW5kZWZpbmVkT3JOdWxsKHRoZVZhbCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuICdyZ2IoMTAwLDEwMCwxMDApJztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBwZXJjZW50ID0gKHRoZVZhbCAtIG1pblZhbCkgLyAobWF4VmFsIC0gbWluVmFsKTtcclxuXHJcbiAgICAgICAgaWYgKGZsaXBDb2xvcnMgPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICBwZXJjZW50ID0gMSAtIHBlcmNlbnQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAocGVyY2VudCA+PSAxKSB7XHJcbiAgICAgICAgICAgIHIgPSAyNTU7XHJcbiAgICAgICAgICAgIGcgPSAwO1xyXG4gICAgICAgICAgICBiID0gMDtcclxuICAgICAgICB9IGVsc2UgaWYgKHBlcmNlbnQgPD0gMCkge1xyXG4gICAgICAgICAgICByID0gMDtcclxuICAgICAgICAgICAgZyA9IDA7XHJcbiAgICAgICAgICAgIGIgPSAyNTU7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwZXJjZW50IDwgLjI1KSB7XHJcbiAgICAgICAgICAgIC8vIGdyZWVuIHVwLCBibHVlIGNvbnN0YW50XHJcbiAgICAgICAgICAgIHIgPSAwO1xyXG4gICAgICAgICAgICBnID0gTWF0aC5mbG9vcigyNTUgKiBwZXJjZW50IC8gMC4yNSk7XHJcbiAgICAgICAgICAgIGIgPSAyNTU7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwZXJjZW50IDwgMC41MCkge1xyXG4gICAgICAgICAgICAvL2JsdWUgZG93biwgZ3JlZW4gY29uc3RhbnRcclxuICAgICAgICAgICAgcmF0aW8gPSAocGVyY2VudCAtIDAuMjUpIC8gMC4yNTtcclxuICAgICAgICAgICAgciA9IDA7XHJcbiAgICAgICAgICAgIGcgPSAyNTU7XHJcbiAgICAgICAgICAgIGIgPSAyNTUgLSBNYXRoLmZsb29yKDI1NSAqIHJhdGlvKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHBlcmNlbnQgPCAwLjc1KSB7XHJcbiAgICAgICAgICAgIC8vIHJlZCB1cCwgZ3JlZW4gY29uc3RhbnRcclxuICAgICAgICAgICAgcmF0aW8gPSAocGVyY2VudCAtIDAuNSkgLyAwLjI1O1xyXG4gICAgICAgICAgICByID0gTWF0aC5mbG9vcigyNTUgKiByYXRpbyk7XHJcbiAgICAgICAgICAgIGcgPSAyNTU7XHJcbiAgICAgICAgICAgIGIgPSAwO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIGdyZWVuIGRvd24sIHJlZCBjb25zdGFudFxyXG4gICAgICAgICAgICByYXRpbyA9IChwZXJjZW50IC0gMC43NSkgLyAwLjI1O1xyXG4gICAgICAgICAgICByID0gMjU1O1xyXG4gICAgICAgICAgICBnID0gMjU1IC0gTWF0aC5mbG9vcigyNTUgKiByYXRpbyk7XHJcbiAgICAgICAgICAgIGIgPSAwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgciA9IHIudG9GaXhlZCgpO1xyXG4gICAgICAgIGcgPSBnLnRvRml4ZWQoKTtcclxuICAgICAgICBiID0gYi50b0ZpeGVkKCk7XHJcblxyXG4gICAgICAgIHJldHVybiAncmdiKCcgKyByICsgJywnICsgZyArICcsJyArIGIgKyAnKSc7XHJcbiAgICB9O1xyXG59XHJcblxyXG5ubS5tYWtlQmx1ZUdyZWVuUmVkR3JhZGllbnQgPSBtYWtlQmx1ZUdyZWVuUmVkR3JhZGllbnQ7XHJcblxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSBhIGZ1bmN0aW9uIHRoYXQgd2lsbCByZXR1cm4gY29sb3JzIGJhc2VkIG9uIGEgZ3JhZGllbnRcclxuICogQHBhcmFtIHtudW1iZXJ9IG1lZGlhbiAtIG1lZGlhbiB2YWx1ZVxyXG4gKiBAcGFyYW0ge251bWJlcn0gc3RkRGV2IC0gc3RhbmRhcmQgZGV2aWF0aW9uXHJcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gZmxpcENvbG9ycyAtIGlmIHRoZSBjb2xvcnMgc2hvdWxkIGJlIGZsaXBwZWRcclxuICogQHJldHVybnMge2NvbG9yTG9va3VwQnlOdW1iZXJ9IGNvbG9yIGxvb2t1cCBmdW5jdGlvblxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIG1ha2VCbHVlR3JlZW5SZWRHcmFkaWVudFpTY29yZShtZWRpYW4sIHN0ZERldiwgZmxpcENvbG9ycykge1xyXG5cclxuICAgIGxldCBncmQgPSBtYWtlQmx1ZUdyZWVuUmVkR3JhZGllbnQoLTIuNSwgMi41LCBmbGlwQ29sb3JzKTtcclxuXHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKHRoZVZhbCkge1xyXG5cclxuICAgICAgICBsZXQgelNjb3JlO1xyXG4gICAgICAgIGlmICh0aGVWYWwgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICB6U2NvcmUgPSBudWxsO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHpTY29yZSA9ICh0aGVWYWwgLSBtZWRpYW4pIC8gc3RkRGV2O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGdyZCh6U2NvcmUpO1xyXG4gICAgfTtcclxufVxyXG5cclxubm0ubWFrZUJsdWVHcmVlblJlZEdyYWRpZW50WlNjb3JlID0gbWFrZUJsdWVHcmVlblJlZEdyYWRpZW50WlNjb3JlO1xyXG4iXX0=
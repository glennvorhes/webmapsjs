"use strict";
/**
 * Created by gavorhes on 11/3/2015.
 */
var provide_1 = require("./provide");
var chk = require("./checkDefined");
var nm = provide_1.default('util.colors');
/**
 * helper function to convert to hex
 * @param {number|string} x - the number to convert to hex
 * @returns {string} number as hex
 * @private
 */
function _hex(x) {
    var hexDigits = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "a", "b", "c", "d", "e", "f"];
    return isNaN(x) ? "00" : hexDigits[(x - x % 16) / 16] + hexDigits[x % 16];
}
/**
 * converts an RGB string to hex
 * @param {string} rgb - rgb color
 * @returns {string} rbg as hex
 */
function rgb2hex(rgb) {
    var rgb1 = rgb.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);
    return ("#" + _hex(rgb1[1]) + _hex(rgb1[2]) + _hex(rgb1[3])).toUpperCase();
}
exports.rgb2hex = rgb2hex;
nm.rgb2hex = rgb2hex;
/**
 * Convert hex string to RGB or RGBA string
 * @param {string} hexString - hex color string
 * @param {number} [alphaVal=undefined] Alpha value
 * @returns {string} - rgb or rgba color
 */
function hexAlphaToRgbOrRgba(hexString, alphaVal) {
    hexString = ((hexString.charAt(0) == "#") ? hexString.substring(1, 7) : hexString);
    var r = parseInt(hexString.substring(0, 2), 16).toString() || '0';
    var g = parseInt(hexString.substring(2, 4), 16).toString() || '0';
    var b = parseInt(hexString.substring(4, 6), 16).toString() || '0';
    if (alphaVal) {
        return "rgba(" + r + "," + g + "," + b + "," + alphaVal + ")";
    }
    else {
        return "rgba(" + r + "," + g + "," + b + ")";
    }
}
exports.hexAlphaToRgbOrRgba = hexAlphaToRgbOrRgba;
nm.hexAlphaToRgbOrRgba = hexAlphaToRgbOrRgba;
/**
 * adds alpha value to rgb string 'rgb(r, b, g)', returns 'rgba(r, g, b, a)'
 * @param {string} rgb - rgb color
 * @param {number} alpha - alpha value 0 to 1
 * @returns {string} rgba color
 */
function rgbToRgba(rgb, alpha) {
    var pieces = rgb.split(',');
    pieces[0] = pieces[0].replace('rgb', 'rgba');
    pieces[2] = pieces[2].replace(')', '');
    pieces.push(' ' + alpha.toFixed(1) + ')');
    return pieces.join(',');
}
exports.rgbToRgba = rgbToRgba;
nm.rgbToRgba = rgbToRgba;
/**
 * @typedef {function} colorLookupByNumber
 * @param {number} num - the number to use to retrieve the color
 * @returns {string} rgb color
 */
/**
 * Make a blue green red gradient
 * @param {number} minVal - minimum value
 * @param {number} maxVal - maximum value
 * @param {boolean} flipColors - if the colors should be flipped
 * @returns {colorLookupByNumber} color lookup function
 */
function makeBlueGreenRedGradient(minVal, maxVal, flipColors) {
    if (typeof flipColors != "boolean") {
        flipColors = false;
    }
    return function (theVal) {
        var r, g, b;
        var ratio;
        if (chk.undefinedOrNull(theVal)) {
            return 'rgb(100,100,100)';
        }
        var percent = (theVal - minVal) / (maxVal - minVal);
        if (flipColors == true) {
            percent = 1 - percent;
        }
        if (percent >= 1) {
            r = 255;
            g = 0;
            b = 0;
        }
        else if (percent <= 0) {
            r = 0;
            g = 0;
            b = 255;
        }
        else if (percent < .25) {
            // green up, blue constant
            r = 0;
            g = Math.floor(255 * percent / 0.25);
            b = 255;
        }
        else if (percent < 0.50) {
            //blue down, green constant
            ratio = (percent - 0.25) / 0.25;
            r = 0;
            g = 255;
            b = 255 - Math.floor(255 * ratio);
        }
        else if (percent < 0.75) {
            // red up, green constant
            ratio = (percent - 0.5) / 0.25;
            r = Math.floor(255 * ratio);
            g = 255;
            b = 0;
        }
        else {
            // green down, red constant
            ratio = (percent - 0.75) / 0.25;
            r = 255;
            g = 255 - Math.floor(255 * ratio);
            b = 0;
        }
        r = r.toFixed();
        g = g.toFixed();
        b = b.toFixed();
        return 'rgb(' + r + ',' + g + ',' + b + ')';
    };
}
exports.makeBlueGreenRedGradient = makeBlueGreenRedGradient;
nm.makeBlueGreenRedGradient = makeBlueGreenRedGradient;
/**
 * Create a function that will return colors based on a gradient
 * @param {number} median - median value
 * @param {number} stdDev - standard deviation
 * @param {boolean} flipColors - if the colors should be flipped
 * @returns {colorLookupByNumber} color lookup function
 */
function makeBlueGreenRedGradientZScore(median, stdDev, flipColors) {
    var grd = makeBlueGreenRedGradient(-2.5, 2.5, flipColors);
    return function (theVal) {
        var zScore;
        if (theVal == null) {
            zScore = null;
        }
        else {
            zScore = (theVal - median) / stdDev;
        }
        return grd(zScore);
    };
}
exports.makeBlueGreenRedGradientZScore = makeBlueGreenRedGradientZScore;
nm.makeBlueGreenRedGradientZScore = makeBlueGreenRedGradientZScore;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sb3JzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3V0aWwvY29sb3JzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7R0FFRztBQUNILHFDQUFnQztBQUNoQyxvQ0FBc0M7QUFDdEMsSUFBSSxFQUFFLEdBQUcsaUJBQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQztBQUdoQzs7Ozs7R0FLRztBQUNILGNBQWMsQ0FBQztJQUNYLElBQUksU0FBUyxHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFFakcsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsR0FBRyxTQUFTLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO0FBQzlFLENBQUM7QUFFRDs7OztHQUlHO0FBQ0gsaUJBQXdCLEdBQUc7SUFDdkIsSUFBSSxJQUFJLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxrQ0FBa0MsQ0FBQyxDQUFDO0lBRXpELE1BQU0sQ0FBQyxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO0FBQy9FLENBQUM7QUFKRCwwQkFJQztBQUVELEVBQUUsQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO0FBR3JCOzs7OztHQUtHO0FBQ0gsNkJBQW9DLFNBQVMsRUFBRSxRQUFRO0lBQ25ELFNBQVMsR0FBRyxDQUFDLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxHQUFHLENBQUMsR0FBRyxTQUFTLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxTQUFTLENBQUMsQ0FBQztJQUNuRixJQUFJLENBQUMsR0FBRyxRQUFRLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDO0lBQ2xFLElBQUksQ0FBQyxHQUFHLFFBQVEsQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUM7SUFDbEUsSUFBSSxDQUFDLEdBQUcsUUFBUSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLFFBQVEsRUFBRSxJQUFJLEdBQUcsQ0FBQztJQUNsRSxFQUFFLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO1FBQ1gsTUFBTSxDQUFDLFVBQVEsQ0FBQyxTQUFJLENBQUMsU0FBSSxDQUFDLFNBQUksUUFBUSxNQUFHLENBQUM7SUFDOUMsQ0FBQztJQUFDLElBQUksQ0FBQyxDQUFDO1FBQ0osTUFBTSxDQUFDLFVBQVEsQ0FBQyxTQUFJLENBQUMsU0FBSSxDQUFDLE1BQUcsQ0FBQztJQUNsQyxDQUFDO0FBQ0wsQ0FBQztBQVZELGtEQVVDO0FBRUQsRUFBRSxDQUFDLG1CQUFtQixHQUFHLG1CQUFtQixDQUFDO0FBRzdDOzs7OztHQUtHO0FBQ0gsbUJBQTBCLEdBQUcsRUFBRSxLQUFLO0lBQ2hDLElBQUksTUFBTSxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDNUIsTUFBTSxDQUFDLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQzdDLE1BQU0sQ0FBQyxDQUFDLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUN2QyxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDO0lBRTFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQzVCLENBQUM7QUFQRCw4QkFPQztBQUVELEVBQUUsQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDO0FBR3pCOzs7O0dBSUc7QUFHSDs7Ozs7O0dBTUc7QUFDSCxrQ0FBeUMsTUFBTSxFQUFFLE1BQU0sRUFBRSxVQUFVO0lBRS9ELEVBQUUsQ0FBQyxDQUFDLE9BQU8sVUFBVSxJQUFJLFNBQVMsQ0FBQyxDQUFDLENBQUM7UUFDakMsVUFBVSxHQUFHLEtBQUssQ0FBQztJQUN2QixDQUFDO0lBRUQsTUFBTSxDQUFDLFVBQVUsTUFBTTtRQUNuQixJQUFJLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ1osSUFBSSxLQUFLLENBQUM7UUFFVixFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM5QixNQUFNLENBQUMsa0JBQWtCLENBQUM7UUFDOUIsQ0FBQztRQUVELElBQUksT0FBTyxHQUFHLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQyxDQUFDO1FBRXBELEVBQUUsQ0FBQyxDQUFDLFVBQVUsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQ3JCLE9BQU8sR0FBRyxDQUFDLEdBQUcsT0FBTyxDQUFDO1FBQzFCLENBQUM7UUFFRCxFQUFFLENBQUMsQ0FBQyxPQUFPLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNmLENBQUMsR0FBRyxHQUFHLENBQUM7WUFDUixDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ04sQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNWLENBQUM7UUFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsT0FBTyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdEIsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNOLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDTixDQUFDLEdBQUcsR0FBRyxDQUFDO1FBQ1osQ0FBQztRQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxPQUFPLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUN2QiwwQkFBMEI7WUFDMUIsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNOLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsR0FBRyxPQUFPLEdBQUcsSUFBSSxDQUFDLENBQUM7WUFDckMsQ0FBQyxHQUFHLEdBQUcsQ0FBQztRQUNaLENBQUM7UUFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDeEIsMkJBQTJCO1lBQzNCLEtBQUssR0FBRyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUM7WUFDaEMsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNOLENBQUMsR0FBRyxHQUFHLENBQUM7WUFDUixDQUFDLEdBQUcsR0FBRyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxHQUFHLEtBQUssQ0FBQyxDQUFDO1FBQ3RDLENBQUM7UUFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDeEIseUJBQXlCO1lBQ3pCLEtBQUssR0FBRyxDQUFDLE9BQU8sR0FBRyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUM7WUFDL0IsQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxHQUFHLEtBQUssQ0FBQyxDQUFDO1lBQzVCLENBQUMsR0FBRyxHQUFHLENBQUM7WUFDUixDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ1YsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ0osMkJBQTJCO1lBQzNCLEtBQUssR0FBRyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUM7WUFDaEMsQ0FBQyxHQUFHLEdBQUcsQ0FBQztZQUNSLENBQUMsR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLEdBQUcsS0FBSyxDQUFDLENBQUM7WUFDbEMsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNWLENBQUM7UUFFRCxDQUFDLEdBQUcsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ2hCLENBQUMsR0FBRyxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDaEIsQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUVoQixNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDO0lBQ2hELENBQUMsQ0FBQztBQUNOLENBQUM7QUEzREQsNERBMkRDO0FBRUQsRUFBRSxDQUFDLHdCQUF3QixHQUFHLHdCQUF3QixDQUFDO0FBR3ZEOzs7Ozs7R0FNRztBQUNILHdDQUErQyxNQUFNLEVBQUUsTUFBTSxFQUFFLFVBQVU7SUFFckUsSUFBSSxHQUFHLEdBQUcsd0JBQXdCLENBQUMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLFVBQVUsQ0FBQyxDQUFDO0lBRTFELE1BQU0sQ0FBQyxVQUFVLE1BQU07UUFFbkIsSUFBSSxNQUFNLENBQUM7UUFDWCxFQUFFLENBQUMsQ0FBQyxNQUFNLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQztZQUNqQixNQUFNLEdBQUcsSUFBSSxDQUFDO1FBQ2xCLENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNKLE1BQU0sR0FBRyxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUMsR0FBRyxNQUFNLENBQUM7UUFDeEMsQ0FBQztRQUVELE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDdkIsQ0FBQyxDQUFDO0FBQ04sQ0FBQztBQWZELHdFQWVDO0FBRUQsRUFBRSxDQUFDLDhCQUE4QixHQUFHLDhCQUE4QixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIENyZWF0ZWQgYnkgZ2F2b3JoZXMgb24gMTEvMy8yMDE1LlxyXG4gKi9cclxuaW1wb3J0IHByb3ZpZGUgZnJvbSAnLi9wcm92aWRlJztcclxuaW1wb3J0ICogYXMgY2hrIGZyb20gJy4vY2hlY2tEZWZpbmVkJztcclxubGV0IG5tID0gcHJvdmlkZSgndXRpbC5jb2xvcnMnKTtcclxuXHJcblxyXG4vKipcclxuICogaGVscGVyIGZ1bmN0aW9uIHRvIGNvbnZlcnQgdG8gaGV4XHJcbiAqIEBwYXJhbSB7bnVtYmVyfHN0cmluZ30geCAtIHRoZSBudW1iZXIgdG8gY29udmVydCB0byBoZXhcclxuICogQHJldHVybnMge3N0cmluZ30gbnVtYmVyIGFzIGhleFxyXG4gKiBAcHJpdmF0ZVxyXG4gKi9cclxuZnVuY3Rpb24gX2hleCh4KSB7XHJcbiAgICBsZXQgaGV4RGlnaXRzID0gW1wiMFwiLCBcIjFcIiwgXCIyXCIsIFwiM1wiLCBcIjRcIiwgXCI1XCIsIFwiNlwiLCBcIjdcIiwgXCI4XCIsIFwiOVwiLCBcImFcIiwgXCJiXCIsIFwiY1wiLCBcImRcIiwgXCJlXCIsIFwiZlwiXTtcclxuXHJcbiAgICByZXR1cm4gaXNOYU4oeCkgPyBcIjAwXCIgOiBoZXhEaWdpdHNbKHggLSB4ICUgMTYpIC8gMTZdICsgaGV4RGlnaXRzW3ggJSAxNl07XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBjb252ZXJ0cyBhbiBSR0Igc3RyaW5nIHRvIGhleFxyXG4gKiBAcGFyYW0ge3N0cmluZ30gcmdiIC0gcmdiIGNvbG9yXHJcbiAqIEByZXR1cm5zIHtzdHJpbmd9IHJiZyBhcyBoZXhcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiByZ2IyaGV4KHJnYikge1xyXG4gICAgbGV0IHJnYjEgPSByZ2IubWF0Y2goL15yZ2JcXCgoXFxkKyksXFxzKihcXGQrKSxcXHMqKFxcZCspXFwpJC8pO1xyXG5cclxuICAgIHJldHVybiAoXCIjXCIgKyBfaGV4KHJnYjFbMV0pICsgX2hleChyZ2IxWzJdKSArIF9oZXgocmdiMVszXSkpLnRvVXBwZXJDYXNlKCk7XHJcbn1cclxuXHJcbm5tLnJnYjJoZXggPSByZ2IyaGV4O1xyXG5cclxuXHJcbi8qKlxyXG4gKiBDb252ZXJ0IGhleCBzdHJpbmcgdG8gUkdCIG9yIFJHQkEgc3RyaW5nXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBoZXhTdHJpbmcgLSBoZXggY29sb3Igc3RyaW5nXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBbYWxwaGFWYWw9dW5kZWZpbmVkXSBBbHBoYSB2YWx1ZVxyXG4gKiBAcmV0dXJucyB7c3RyaW5nfSAtIHJnYiBvciByZ2JhIGNvbG9yXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gaGV4QWxwaGFUb1JnYk9yUmdiYShoZXhTdHJpbmcsIGFscGhhVmFsKSB7XHJcbiAgICBoZXhTdHJpbmcgPSAoKGhleFN0cmluZy5jaGFyQXQoMCkgPT0gXCIjXCIpID8gaGV4U3RyaW5nLnN1YnN0cmluZygxLCA3KSA6IGhleFN0cmluZyk7XHJcbiAgICBsZXQgciA9IHBhcnNlSW50KGhleFN0cmluZy5zdWJzdHJpbmcoMCwgMiksIDE2KS50b1N0cmluZygpIHx8ICcwJztcclxuICAgIGxldCBnID0gcGFyc2VJbnQoaGV4U3RyaW5nLnN1YnN0cmluZygyLCA0KSwgMTYpLnRvU3RyaW5nKCkgfHwgJzAnO1xyXG4gICAgbGV0IGIgPSBwYXJzZUludChoZXhTdHJpbmcuc3Vic3RyaW5nKDQsIDYpLCAxNikudG9TdHJpbmcoKSB8fCAnMCc7XHJcbiAgICBpZiAoYWxwaGFWYWwpIHtcclxuICAgICAgICByZXR1cm4gYHJnYmEoJHtyfSwke2d9LCR7Yn0sJHthbHBoYVZhbH0pYDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIGByZ2JhKCR7cn0sJHtnfSwke2J9KWA7XHJcbiAgICB9XHJcbn1cclxuXHJcbm5tLmhleEFscGhhVG9SZ2JPclJnYmEgPSBoZXhBbHBoYVRvUmdiT3JSZ2JhO1xyXG5cclxuXHJcbi8qKlxyXG4gKiBhZGRzIGFscGhhIHZhbHVlIHRvIHJnYiBzdHJpbmcgJ3JnYihyLCBiLCBnKScsIHJldHVybnMgJ3JnYmEociwgZywgYiwgYSknXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSByZ2IgLSByZ2IgY29sb3JcclxuICogQHBhcmFtIHtudW1iZXJ9IGFscGhhIC0gYWxwaGEgdmFsdWUgMCB0byAxXHJcbiAqIEByZXR1cm5zIHtzdHJpbmd9IHJnYmEgY29sb3JcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiByZ2JUb1JnYmEocmdiLCBhbHBoYSkge1xyXG4gICAgbGV0IHBpZWNlcyA9IHJnYi5zcGxpdCgnLCcpO1xyXG4gICAgcGllY2VzWzBdID0gcGllY2VzWzBdLnJlcGxhY2UoJ3JnYicsICdyZ2JhJyk7XHJcbiAgICBwaWVjZXNbMl0gPSBwaWVjZXNbMl0ucmVwbGFjZSgnKScsICcnKTtcclxuICAgIHBpZWNlcy5wdXNoKCcgJyArIGFscGhhLnRvRml4ZWQoMSkgKyAnKScpO1xyXG5cclxuICAgIHJldHVybiBwaWVjZXMuam9pbignLCcpO1xyXG59XHJcblxyXG5ubS5yZ2JUb1JnYmEgPSByZ2JUb1JnYmE7XHJcblxyXG5cclxuLyoqXHJcbiAqIEB0eXBlZGVmIHtmdW5jdGlvbn0gY29sb3JMb29rdXBCeU51bWJlclxyXG4gKiBAcGFyYW0ge251bWJlcn0gbnVtIC0gdGhlIG51bWJlciB0byB1c2UgdG8gcmV0cmlldmUgdGhlIGNvbG9yXHJcbiAqIEByZXR1cm5zIHtzdHJpbmd9IHJnYiBjb2xvclxyXG4gKi9cclxuXHJcblxyXG4vKipcclxuICogTWFrZSBhIGJsdWUgZ3JlZW4gcmVkIGdyYWRpZW50XHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBtaW5WYWwgLSBtaW5pbXVtIHZhbHVlXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBtYXhWYWwgLSBtYXhpbXVtIHZhbHVlXHJcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gZmxpcENvbG9ycyAtIGlmIHRoZSBjb2xvcnMgc2hvdWxkIGJlIGZsaXBwZWRcclxuICogQHJldHVybnMge2NvbG9yTG9va3VwQnlOdW1iZXJ9IGNvbG9yIGxvb2t1cCBmdW5jdGlvblxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIG1ha2VCbHVlR3JlZW5SZWRHcmFkaWVudChtaW5WYWwsIG1heFZhbCwgZmxpcENvbG9ycykge1xyXG5cclxuICAgIGlmICh0eXBlb2YgZmxpcENvbG9ycyAhPSBcImJvb2xlYW5cIikge1xyXG4gICAgICAgIGZsaXBDb2xvcnMgPSBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKHRoZVZhbCkge1xyXG4gICAgICAgIGxldCByLCBnLCBiO1xyXG4gICAgICAgIGxldCByYXRpbztcclxuXHJcbiAgICAgICAgaWYgKGNoay51bmRlZmluZWRPck51bGwodGhlVmFsKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gJ3JnYigxMDAsMTAwLDEwMCknO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IHBlcmNlbnQgPSAodGhlVmFsIC0gbWluVmFsKSAvIChtYXhWYWwgLSBtaW5WYWwpO1xyXG5cclxuICAgICAgICBpZiAoZmxpcENvbG9ycyA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgIHBlcmNlbnQgPSAxIC0gcGVyY2VudDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChwZXJjZW50ID49IDEpIHtcclxuICAgICAgICAgICAgciA9IDI1NTtcclxuICAgICAgICAgICAgZyA9IDA7XHJcbiAgICAgICAgICAgIGIgPSAwO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocGVyY2VudCA8PSAwKSB7XHJcbiAgICAgICAgICAgIHIgPSAwO1xyXG4gICAgICAgICAgICBnID0gMDtcclxuICAgICAgICAgICAgYiA9IDI1NTtcclxuICAgICAgICB9IGVsc2UgaWYgKHBlcmNlbnQgPCAuMjUpIHtcclxuICAgICAgICAgICAgLy8gZ3JlZW4gdXAsIGJsdWUgY29uc3RhbnRcclxuICAgICAgICAgICAgciA9IDA7XHJcbiAgICAgICAgICAgIGcgPSBNYXRoLmZsb29yKDI1NSAqIHBlcmNlbnQgLyAwLjI1KTtcclxuICAgICAgICAgICAgYiA9IDI1NTtcclxuICAgICAgICB9IGVsc2UgaWYgKHBlcmNlbnQgPCAwLjUwKSB7XHJcbiAgICAgICAgICAgIC8vYmx1ZSBkb3duLCBncmVlbiBjb25zdGFudFxyXG4gICAgICAgICAgICByYXRpbyA9IChwZXJjZW50IC0gMC4yNSkgLyAwLjI1O1xyXG4gICAgICAgICAgICByID0gMDtcclxuICAgICAgICAgICAgZyA9IDI1NTtcclxuICAgICAgICAgICAgYiA9IDI1NSAtIE1hdGguZmxvb3IoMjU1ICogcmF0aW8pO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocGVyY2VudCA8IDAuNzUpIHtcclxuICAgICAgICAgICAgLy8gcmVkIHVwLCBncmVlbiBjb25zdGFudFxyXG4gICAgICAgICAgICByYXRpbyA9IChwZXJjZW50IC0gMC41KSAvIDAuMjU7XHJcbiAgICAgICAgICAgIHIgPSBNYXRoLmZsb29yKDI1NSAqIHJhdGlvKTtcclxuICAgICAgICAgICAgZyA9IDI1NTtcclxuICAgICAgICAgICAgYiA9IDA7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gZ3JlZW4gZG93biwgcmVkIGNvbnN0YW50XHJcbiAgICAgICAgICAgIHJhdGlvID0gKHBlcmNlbnQgLSAwLjc1KSAvIDAuMjU7XHJcbiAgICAgICAgICAgIHIgPSAyNTU7XHJcbiAgICAgICAgICAgIGcgPSAyNTUgLSBNYXRoLmZsb29yKDI1NSAqIHJhdGlvKTtcclxuICAgICAgICAgICAgYiA9IDA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByID0gci50b0ZpeGVkKCk7XHJcbiAgICAgICAgZyA9IGcudG9GaXhlZCgpO1xyXG4gICAgICAgIGIgPSBiLnRvRml4ZWQoKTtcclxuXHJcbiAgICAgICAgcmV0dXJuICdyZ2IoJyArIHIgKyAnLCcgKyBnICsgJywnICsgYiArICcpJztcclxuICAgIH07XHJcbn1cclxuXHJcbm5tLm1ha2VCbHVlR3JlZW5SZWRHcmFkaWVudCA9IG1ha2VCbHVlR3JlZW5SZWRHcmFkaWVudDtcclxuXHJcblxyXG4vKipcclxuICogQ3JlYXRlIGEgZnVuY3Rpb24gdGhhdCB3aWxsIHJldHVybiBjb2xvcnMgYmFzZWQgb24gYSBncmFkaWVudFxyXG4gKiBAcGFyYW0ge251bWJlcn0gbWVkaWFuIC0gbWVkaWFuIHZhbHVlXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBzdGREZXYgLSBzdGFuZGFyZCBkZXZpYXRpb25cclxuICogQHBhcmFtIHtib29sZWFufSBmbGlwQ29sb3JzIC0gaWYgdGhlIGNvbG9ycyBzaG91bGQgYmUgZmxpcHBlZFxyXG4gKiBAcmV0dXJucyB7Y29sb3JMb29rdXBCeU51bWJlcn0gY29sb3IgbG9va3VwIGZ1bmN0aW9uXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gbWFrZUJsdWVHcmVlblJlZEdyYWRpZW50WlNjb3JlKG1lZGlhbiwgc3RkRGV2LCBmbGlwQ29sb3JzKSB7XHJcblxyXG4gICAgbGV0IGdyZCA9IG1ha2VCbHVlR3JlZW5SZWRHcmFkaWVudCgtMi41LCAyLjUsIGZsaXBDb2xvcnMpO1xyXG5cclxuICAgIHJldHVybiBmdW5jdGlvbiAodGhlVmFsKSB7XHJcblxyXG4gICAgICAgIGxldCB6U2NvcmU7XHJcbiAgICAgICAgaWYgKHRoZVZhbCA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHpTY29yZSA9IG51bGw7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgelNjb3JlID0gKHRoZVZhbCAtIG1lZGlhbikgLyBzdGREZXY7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gZ3JkKHpTY29yZSk7XHJcbiAgICB9O1xyXG59XHJcblxyXG5ubS5tYWtlQmx1ZUdyZWVuUmVkR3JhZGllbnRaU2NvcmUgPSBtYWtlQmx1ZUdyZWVuUmVkR3JhZGllbnRaU2NvcmU7XHJcbiJdfQ==